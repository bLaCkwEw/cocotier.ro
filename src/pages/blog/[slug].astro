---
import BlogLayout from "@layouts/BlogLayout.astro"
import Markdown from "@astrojs/markdown-component"
import type { Post } from "@components/types"
import { directus } from "@components/helpers/directus"

export async function getStaticPaths() {
	const data = await directus.getPosts()

	return data.map((post: Post) => {
		return {
			params: {
				slug: post.slug,
			},
			props: { post },
		}
	})
}

const { post } = Astro.props
---

<BlogLayout
	title={post.title}
	description={post.description}
	image={`https://tcwk2rc4.directus.app/assets/${post.image}?width=500`}
>
	<header>
		<Markdown>
			# {post.title}
		</Markdown>
	</header>

	<img
		src={`https://tcwk2rc4.directus.app/assets/${post.image}/${post.image_name}?format=webp`}
		alt={post.image_name}
		width="200px"
		height="auto"
		loading="lazy"
	/>

	<Markdown content={post.content} />
</BlogLayout>

<style>
	img {
		@apply max-h-96;
	}
</style>
